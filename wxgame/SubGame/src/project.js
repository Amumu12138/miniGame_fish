require=function o(r,s,c){function l(t,e){if(!s[t]){if(!r[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(g)return g(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[t]={exports:{}};r[t][0].call(i.exports,function(e){return l(r[t][1][e]||e)},i,i.exports,o,r,s,c)}return s[t].exports}for(var g="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({GameRankingList:[function(e,t,a){"use strict";cc._RF.push(t,"a0ea2Faum1JDKkSr0Ka631L","GameRankingList"),cc.Class({extends:cc.Component,name:"GameRankingList",properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab,prefabGameOverRank:cc.Prefab,gameOverRankLayout:cc.Node,loadingLabel:cc.Node},start:function(){var t=this;this.removeChild(),window.wx.onMessage(function(e){cc.log("接收主域发来消息：",e),0==e.messageType?t.removeChild():1==e.messageType?t.fetchFriendData(e.MAIN_MENU_NUM):3==e.messageType?t.submitScore(e.MAIN_MENU_NUM,e.score):4==e.messageType?t.gameOverRank(e.MAIN_MENU_NUM):5==e.messageType?t.fetchGroupFriendData(e.MAIN_MENU_NUM,e.shareTicket):6==e.messageType&&t.fetchWorldData(e.MAIN_MENU_NUM)})},submitScore:function(t,a){window.wx.getUserCloudStorage({keyList:["x"+t],success:function(e){console.log("getUserCloudStorage","success",e),0!=e.KVDataList.length&&("Classic"==t&&window.wx.setUserCloudStorage({KVDataList:[{key:"Classic",value:'{"wxgame":{"score":'+(e.KVDataList[0].value>a?e.KVDataList[0].value:a)+',"update_time": '+(new Date).getTime()+"}}"}]}),e.KVDataList[0].value>a)||window.wx.setUserCloudStorage({KVDataList:[{key:"x"+t,value:""+a}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},removeChild:function(){var e=this.node.getChildByName("userItem");this.node.removeChild(e),this.scrollViewContent.removeAllChildren(),this.scrollViewContent.active=!1,this.rankingScrollView.node.active=!1,this.gameOverRankLayout.removeAllChildren(),this.gameOverRankLayout.active=!1,this.loadingLabel.string="玩命加载中...",this.loadingLabel.active=!0},fetchFriendData:function(t){var s=this;this.removeChild(),this.rankingScrollView.node.active=!0,this.scrollViewContent.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){s.loadingLabel.active=!1,console.log("success",e.data);var r=e.data[0];wx.getFriendCloudStorage({keyList:["x"+t],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++){var n=t[a],i=cc.instantiate(s.prefabRankItem);if(i.getComponent("RankItem").init(a,n),s.scrollViewContent.addChild(i),t[a].avatarUrl==r.avatarUrl){var o=cc.instantiate(s.prefabRankItem);o.getComponent("RankItem").init(a,n),o.y=-300,s.node.addChild(o,1,"userItem")}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),s.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){s.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fetchGroupFriendData:function(t,a){var s=this;this.removeChild(),this.rankingScrollView.node.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);var r=e.data[0];wx.getGroupCloudStorage({shareTicket:a,keyList:["x"+t],success:function(e){console.log("wx.getGroupCloudStorage success",e),s.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++){var n=t[a],i=cc.instantiate(s.prefabRankItem);if(i.getComponent("RankItem").init(a,n),s.scrollViewContent.addChild(i),t[a].avatarUrl==r.avatarUrl){var o=cc.instantiate(s.prefabRankItem);o.getComponent("RankItem").init(a,n),o.y=-300,s.node.addChild(o,1,"userItem")}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),s.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){s.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fetchWorldData:function(e){this.removeChild(),this.rankingScrollView.node.active=!0,this.loadingLabel.active=!1},gameOverRank:function(t){var g=this;this.removeChild(),this.gameOverRankLayout.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){cc.log("success",e.data);var l=e.data[0];wx.getFriendCloudStorage({keyList:["x"+t],success:function(e){cc.log("wx.getFriendCloudStorage success",e),g.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<t.length;a++)if(t[a].avatarUrl==l.avatarUrl){if(0<=a-1){if(a+1>=t.length&&0<=a-2){var n=cc.instantiate(g.prefabGameOverRank);n.getComponent("GameOverRank").init(a-2,t[a-2]),g.gameOverRankLayout.addChild(n)}var i=cc.instantiate(g.prefabGameOverRank);i.getComponent("GameOverRank").init(a-1,t[a-1]),g.gameOverRankLayout.addChild(i)}else if(a+2>=t.length){var o=new cc.Node;o.width=200,g.gameOverRankLayout.addChild(o)}var r=cc.instantiate(g.prefabGameOverRank);if(r.getComponent("GameOverRank").init(a,t[a],!0),g.gameOverRankLayout.addChild(r),a+1<t.length){var s=cc.instantiate(g.prefabGameOverRank);if(s.getComponent("GameOverRank").init(a+1,t[a+1]),g.gameOverRankLayout.addChild(s),a-1<0&&a+2<t.length){var c=cc.instantiate(g.prefabGameOverRank);c.getComponent("GameOverRank").init(a+2,t[a+2]),g.gameOverRankLayout.addChild(c)}}}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),g.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){g.loadingLabel.string="数据加载失败，请检测网络，谢谢。"}})}}),cc._RF.pop()},{}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"dd553fmL+BGfJ9idSJ4ApIP","RankItem"),cc.Class({extends:cc.Component,name:"RankItem",properties:{backSprite:cc.Node,rankLabel:cc.Label,avatarImgSprite:cc.Sprite,nickLabel:cc.Label,topScoreLabel:cc.Label},start:function(){},init:function(e,t){var a=t.avatarUrl,n=t.nickname,i=0!=t.KVDataList.length?t.KVDataList[0].value:0;e%2==1&&(this.backSprite.opacity=41),0==e?(this.rankLabel.node.color=new cc.Color(208,117,19,255),this.rankLabel.node.setScale(2)):1==e?(this.rankLabel.node.color=new cc.Color(238,189,54,255),this.rankLabel.node.setScale(1.6)):2==e&&(this.rankLabel.node.color=new cc.Color(255,219,8,255),this.rankLabel.node.setScale(1.3)),this.rankLabel.string=(e+1).toString(),this.createImage(a),this.nickLabel.string=n,this.topScoreLabel.string=i.toString()},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.avatarImgSprite.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.avatarImgSprite.node.active=!1}},a.src=e}catch(e){cc.log(e),this.avatarImgSprite.node.active=!1}}}),cc._RF.pop()},{}]},{},["GameRankingList","RankItem"]);